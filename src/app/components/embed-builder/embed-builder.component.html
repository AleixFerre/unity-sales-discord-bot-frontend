<div class="builder" [formGroup]="form">
  <header class="builder__header">
    <div>
      <p class="eyebrow">Discord Embed</p>
      <h1>Unity Sales Embed Builder</h1>
      <p class="subtext">
        Craft the promo message, preview it live, then ship to your bot backend.
      </p>
    </div>
  </header>

  <section class="panel">
    <h2>Auth</h2>
    <label class="field" [class.error]="form.get('token')?.touched && form.get('token')?.invalid">
      <span>Bearer token</span>
      <input
        type="password"
        formControlName="token"
        placeholder="••••••••••••••"
        autocomplete="off"
      />
      <small class="error-text" *ngIf="form.get('token')?.touched && form.get('token')?.invalid">
        Token is required.
      </small>
    </label>
  </section>

  <section class="panel" [formGroup]="embedGroup">
    <h2>Core content</h2>
    <div class="grid">
      <label class="field" [class.error]="embedGroup.get('title')?.touched && embedGroup.get('title')?.invalid">
        <span>Title</span>
        <input type="text" formControlName="title" placeholder="Oferta Unity" />
        <small class="error-text" *ngIf="embedGroup.get('title')?.touched && embedGroup.get('title')?.invalid">
          Title is required.
        </small>
      </label>
      <label class="field" [class.error]="embedGroup.get('url')?.touched && embedGroup.get('url')?.invalid">
        <span>URL</span>
        <input type="url" formControlName="url" placeholder="https://assetstore.unity.com" />
        <small
          class="error-text"
          *ngIf="embedGroup.get('url')?.touched && embedGroup.get('url')?.hasError('required')"
        >
          URL is required.
        </small>
        <small
          class="error-text"
          *ngIf="embedGroup.get('url')?.touched && embedGroup.get('url')?.hasError('pattern')"
        >
          Enter a valid URL starting with http:// or https://.
        </small>
        <small class="error-text" *ngIf="!hasToken">Bearer token required to fetch.</small>
        <div class="field__actions">
          <button
            type="button"
            class="ghost"
            (click)="assetStoreScrape.emit()"
            [disabled]="isScraping || !hasToken"
          >
            {{ isScraping ? 'Fetching asset data...' : 'Fetch from Asset Store' }}
          </button>
        </div>
      </label>
    </div>
    <label class="field">
      <span>Description</span>
      <textarea rows="3" formControlName="description" placeholder="Hasta 50% en assets"></textarea>
    </label>
    <div class="grid">
      <label class="field">
        <span>Accent color (decimal)</span>
        <input
          type="color"
          [value]="colorHex"
          (input)="colorChange.emit($any($event.target).value)"
        />
      </label>
    </div>
  </section>

  <section class="panel" [formGroup]="embedGroup">
    <div class="panel__heading">
      <h2>Fields</h2>
      <button type="button" class="ghost" (click)="addField()">Add field</button>
    </div>
    <div class="field-list" formArrayName="fields">
      <div
        class="field-card"
        *ngFor="let field of fieldsArray.controls; let i = index"
        [formGroupName]="i"
      >
        <label class="field">
          <span>Name</span>
          <input type="text" formControlName="name" placeholder="Precio" />
        </label>
        <label class="field">
          <span>Value</span>
          <input type="text" formControlName="value" placeholder="$19.99" />
        </label>
        <label class="field checkbox">
          <input type="checkbox" formControlName="inline" />
          <span>Inline</span>
        </label>
        <button type="button" class="ghost danger" (click)="removeField(i)">Remove</button>
      </div>
    </div>
  </section>

  <section class="panel" [formGroup]="embedGroup">
    <h2>Media</h2>
    <div class="grid">
      <label class="field" formGroupName="thumbnail">
        <span>Thumbnail URL</span>
        <input type="url" formControlName="url" placeholder="https://example.com/thumb.png" />
      </label>
      <label class="field" formGroupName="image">
        <span>Image URL</span>
        <input type="url" formControlName="url" placeholder="https://example.com/banner.png" />
      </label>
    </div>
  </section>

  <section class="panel" [formGroup]="embedGroup">
    <h2>Footer</h2>
    <label
      class="field"
      formGroupName="footer"
      [class.error]="embedGroup.get('footer.text')?.touched && embedGroup.get('footer.text')?.invalid"
    >
      <span>Footer text</span>
      <input type="text" formControlName="text" placeholder="Unity Sales Bot" />
      <small
        class="error-text"
        *ngIf="embedGroup.get('footer.text')?.touched && embedGroup.get('footer.text')?.invalid"
      >
        Footer text is required.
      </small>
    </label>
  </section>
</div>
